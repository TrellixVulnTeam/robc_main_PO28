<?php

use CI\Article;

class CustomLandingPage extends AppModel
{
    public $useTable = 'custom_landing_page';

    public $validate = array(
        'id' => array(
            'rule'    => 'numeric',
            'message' => 'The id is required',
            'required' => true
        ),
        'website_id' => array(
            'rule'    => 'numeric',
            'message' => 'The website id is required and must be valid',
            'required' => true
        ),
        'start_at' => array(
            'rule' => 'notEmpty',
            'message' => 'Enter a valid start date in Y-m-d H:i:s format.',
            'allowEmpty' => false,
            'required' => true
        ),
        'end_at' => array(
            'rule' => 'notEmpty',
            'message' => 'Enter a valid end date in Y-m-d H:i:s format.',
            'allowEmpty' => false,
            'required' => true
        ),
        'image' => array(
            'rule' => 'notEmpty',
            'message' => 'The image is required',
            'required' => true
        ),
        'body_text' => array(
            'rule' => 'notEmpty',
            'message' => 'The body text is required',
            'required' => true
        ),
        'domain_primary' => array(
            'rule' => 'numeric',
            'message' => 'Domain primary is required',
            'allowEmpty' => false,
            'required' => true
        ),
        'readmore_link' => array(
            'rule' => 'notEmpty',
            'message' => 'Read more link is required',
            'allowEmpty' => false,
            'required' => true
        ),
        'headline' => array(
            'rule' => 'notEmpty',
            'message' => 'Headline is required',
            'allowEmpty' => false,
            'required' => true
        ),
        'sex' => array(
            'rule' => 'notEmpty',
            'message' => 'Sex is required',
            'allowEmpty' => false,
            'required' => true
        ),
        'content_rating' => array(
            'rule' => 'notEmpty',
            'message' => 'Content rating is required',
            'allowEmpty' => false,
            'required' => true
        ),
        'category' => array(
            'rule' => 'notEmpty',
            'message' => 'Category is required',
            'allowEmpty' => false,
            'required' => true
        )
    );

    public function get_list($limit, $offset, $status)
    {
        $status_query = '';

        if ($status !== Article::STATUS_ALL) {
            $status_query = "WHERE status = {$status}";
        }

        $query = "SELECT * FROM {$this->useTable} {$status_query} LIMIT {$limit} OFFSET {$offset}";
        $items = $this->query_read($query, false);

        return Set::classicExtract($items, '{n}.custom_landing_page');
    }

    public function findById($article_id)
    {
        if ($article_id < 1) {
            return array();
        }

        $result = parent::findById($article_id);

        return $result == false ? array() : $result;
    }
}