<?php
/**
 * Plugin Name: CrowdIgnite Widget
 * Description: CrowdIgnite Widget
 * Plugin URI: http://get.crowdignite.com
 * Author: Francisco Gonzalez
 * Author URI: http://get.crowdignite.com
 * Version: 1.0
 * License: GPL2
 *
 * Copyright (C) 2014  Francisco Gonzalez  francisco.gonzalez@evolvemediallc.com
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License, version 2, as
 * published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
 */

class Crowdignite extends WP_Widget {

    function __construct() {
        add_action( 'init', array( $this, 'widget_textdomain' ) );

        parent::__construct(
            'crowdignite',
            __( 'CrowdIgnite Widget', 'crowdignite' ),
            array(
                'classname'   => 'crowdignite',
                'description' => __( 'CrowdIgnite widget', 'crowdignite' ),
            )
        );

        add_action( 'admin_print_styles', array( $this, 'register_admin_styles' ) );
        add_action( 'wp_enqueue_scripts', array( $this, 'register_widget_styles' ) );

        add_action( 'admin_enqueue_scripts', array( $this, 'register_admin_scripts' ) );
        add_action( 'wp_enqueue_scripts', array( $this, 'register_widget_scripts' ) );
    }

    function form( $instance ) {
        $instance = wp_parse_args(
            (array) $instance,
            array(
                'title'        => '',
                'widget_id'    => '',
                'show_powered' => 0,
                'account_id'   => '',
                'version'      => 1,
            )
        );

        include( plugin_dir_path( __FILE__ ) . '/views/admin.php' );
    }

    function update( $new_instance, $old_instance ) {
        $old_instance['title']        = strip_tags( addslashes( $new_instance['title'] ) );
        $old_instance['widget_id']    = intval( $new_instance['widget_id'] );
        $old_instance['version']      = intval( $new_instance['version'] );
        $old_instance['show_powered'] = $new_instance['show_powered'];
        $old_instance['account_id']   = strip_tags( addslashes( $new_instance['account_id'] ) );

        return $old_instance;
    }

    function widget( $args, $instance ) {
        extract( $args, EXTR_SKIP );

        echo $before_widget;

        include( plugin_dir_path( __FILE__ ) . '/views/widget.php' );

        echo $after_widget;
    }

    function widget_textdomain() {
        load_plugin_textdomain( 'crowdignite', false, plugin_dir_path( __FILE__ ) . '/lang' );
    }

    function register_admin_styles() {
        wp_enqueue_style( 'crowdignite-admin', plugins_url( 'crowdignite/css/admin.css' ) );
    }

    function register_widget_styles() {
        wp_enqueue_style( 'crowdignite-widget', plugins_url( 'crowdignite/css/widget.css' ) );
    }

    function register_admin_scripts() {
        wp_enqueue_script( 'crowdignite-admin', plugins_url( 'crowdignite/js/admin.js' ) );
    }

    function register_widget_scripts() {
        wp_enqueue_script( 'crowdignite-widget', plugins_url( 'crowdignite/js/widget.js' ) );
    }
}

add_action( 'widgets_init', create_function( '', 'register_widget( "Crowdignite" );' ) );