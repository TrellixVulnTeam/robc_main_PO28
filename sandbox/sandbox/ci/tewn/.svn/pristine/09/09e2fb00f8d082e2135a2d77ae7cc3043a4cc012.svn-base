<?php
App::import('Controller', 'Actions');

class WidgetsActionsController extends ActionsController
{
    public $name  = 'Widgets';
    public $uses  = array('Widget', 'MetricLog');
    public $view  = 'Theme';
    public $theme = 'bootstrap';

    protected $permissions = array(
        'get_list' => User::ADMIN,
        'delete'   => User::ADMIN
    );

    public function delete()
    {
        $this->response->setMessage('Delete a widget');

        $params     = new \CI\ArrayManipulator($this->params['form']);
        $website_id = (int) $params->get('website_id', 0);
        $widget_id  = (int) $params->get('widget_id', 0);

        if ($this->Widget->delete($widget_id)) {
            $this->MetricLog->log(LOG_TYPE_WIDGET_DELETE, $website_id, $widget_id);
            $this->response->addData('id', $widget_id);
        } else {
            $this->response->addErrors($this->Widget->validationErrors);
        }

        return $this->response->get();
    }

    public function get_list()
    {
        $this->response->setMessage('Get list of widgets');

        $params  = new \CI\ArrayManipulator($this->params['url']);
        $widgets = $this->Widget->get_list($params->get('limit', 0), $params->get('offset', 0));

        $this->response->addData('widgets', $widgets);

        return $this->response->get();
    }
}