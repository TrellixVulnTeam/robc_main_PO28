<script src="/js/jquery.blockUI.min.js" type="text/javascript"></script>
<script type="text/javascript">
<!--
jQuery(document).ready(function() {

        jQuery.blockUI.defaults.overlayCSS = {};
        jQuery.blockUI.defaults.css = {};

        jQuery("#add_website_button").click(function(){
            jQuery('#setCacheValue #key').val( '' );
            jQuery('#setCacheValue #expire').val( '' );
            jQuery('#setCacheValue #value').val( '' );
            jQuery('#setCacheValue #key').attr('readonly', false);
            jQuery.blockUI({ message:jQuery("#setCacheValue"), css: {top: '100px', left: '38%', width:'300px', height:'280px'} });
            return false;
        });

        jQuery('.editkey').live("click", function(){            
            var key = jQuery(this).data('key');
            if( jQuery.trim(key)!="" ) {
                jQuery.blockUI({ message:jQuery("#waitingDiv1"), css: {top: '100px', left: '38%', width:'300px', height:'280px'}  });
                $.ajax({
                        url: "/management/memcachedinfo_get",
                        type: "POST",
                        data: {
                            'key' : key
                        },
                        success: function(data){
                            var value = data;
                            jQuery('#setCacheValue #key').attr('readonly', true);
                            jQuery('#setCacheValue #key').val( key );
                            jQuery('#setCacheValue #value').val( value );
                            jQuery.blockUI({ message:jQuery("#setCacheValue"), css: {top: '100px', left: '38%', width:'300px', height:'280px'} });
                        },
                        fail: function(jqXHR, textStatus){
                            alert( "Request failed: " + textStatus );
                        },
                        complete: function() {
                            //jQuery.unblockUI();
                        }
                });
            }
            return false;
        });

        jQuery('#findkey').click( function(){            
            var key = jQuery("#key").val();
            if( key!="" ) {
                jQuery.blockUI({ message:jQuery("#waitingDiv1"), css: {top: '100px', left: '38%', width:'300px', height:'100px'}  });
                jQuery("div.controls").html('');
                $.ajax({
                        url: "/management/memcachedinfo_get",
                        type: "POST",
                        data: {
                            'key' : key
                        },
                        success: function(data){
                            jQuery("textarea.memkey").html(key);
                            jQuery("textarea.memvalue").html(data);
                            jQuery("div.controls").html('<a class="editkey" href="#" data-key="'+key+'" title="Edit">Edit</a>'+' <a class="deletekey" data-key="'+key+'" href="#" title="Delete">Delete</a>');
                        },
                        fail: function(jqXHR, textStatus){
                            alert( "Request failed: " + textStatus );
                        },
                        complete: function() {
                            jQuery.unblockUI();
                        }
                });
            }
            return false;
        });

        jQuery('.deletekey').live("click", function(){
                var key = jQuery(this).data('key');
                $.ajax({
                        url: "/management/memcachedinfo_delete",
                        type: "POST",
                        data: {
                            'key' : key
                        },
                        success: function(data){
                            if(data==1) {
                                jQuery("textarea.memkey").html('');
                                jQuery("textarea.memvalue").html('');
                                jQuery("div.controls").html('');
                            } else {
                                alert('Error. Please try again.');
                            }
                        },
                        fail: function(jqXHR, textStatus){
                            alert( "Request failed: " + textStatus );
                        }
            });
            return false;
        });


        jQuery('#setkey').click( function(){
                var key = jQuery('#setCacheValue #key').val();
                var value = jQuery('#setCacheValue #value').val();
                var expire = jQuery('#setCacheValue #expire').val();
                setkey(key, value, expire);
                return false;
        });
        function setkey(key, value, expire) {
            $.ajax({
                        url: "/management/memcachedinfo_set",
                        type: "POST",
                        data: {
                            'key': key,
                            'value': value,
                            'expire': expire
                        },
                        success: function(data){
                            if(data==1) {
                                location.reload();
                            } else {
                                alert('Error. Please try again.');
                            }
                        },
                        fail: function(jqXHR, textStatus){
                            alert( "Request failed: " + textStatus );
                        }
            });
        }
        
        jQuery("#cancel_set").click(function(){
            jQuery.unblockUI();
        });
});
// -->
</script>  


<div class="row main">
<div id="content" class="column grid_12">

<?
		echo $this->element("management_toolbar", array("tab" => "", "user" => $user));
?>

  <h3 class="topContent">Memcached Information Console</h3>

<div class="row" id="content_area">
	<div class="column grid_12 memcachedinfo">

		<div style="margin:20px 0 20px 20px;">
			<a id="add_website_button"><span>New Cache Value</span></a>
		</div>

		<div id="memcached_findbox">
			Enter Memcached Key  <input type="text" id="key"/>
			<a class="button" href="#" id="findkey">Find</a>
		</div>

		<div id="memcached_resultbox">
			<table>
				<tr>
					<td>Key:</td>
					<td>
						<textarea class="memkey wordwrap" readonly></textarea>
					</td>
					<td>Value:</td>
					<td><textarea class="memvalue wordwrap" readonly></textarea></div></td>
					<td><div class="controls"></div></td>
				</tr>
			</table>
		</div>

	</div>
</div>

  <h3 class="bottomContent"></h3>

</div> <!--  end of content column -->

</div> <!--  end of content row -->

<div id="setCacheValue" style="display:none;cursor:default;">
    <h3>Set Cache Value</h3>
    <p class="message" style="font-size:14px;margin-top:18px;">Key
   <input type="text" id="key" style="width:200px;"></p>

    <p class="message" style="font-size:14px;margin-top:18px;">
    	<table style="margin:0 0 0 25px;">
    		<tr>
    			<td style="font-size:14px;margin-top:18px;">Value</td>
    			<td><textarea id="value" style="width:200px;height:80px;" class="wordwrap"></textarea></td>
    		</tr>
    	</table>
    </p>


    <p class="message" style="font-size:14px;margin-top:18px;">Expire
    <input type="text" id="expire" style="width:200px;"></p>


    <p style="margin-top:18px;"></p>
        <div class="awesome purple" id="setkey">Save</div>
        <div class="awesome purple" id="cancel_set">Cancel</div>
    
</div>

<div id="waitingDiv1" style="display:none;cursor:default;">
Loading...
<p><img src="/img/progress2.gif" width="180">
</div>