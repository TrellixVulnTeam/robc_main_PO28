<?php
namespace CI\Stats\Article;

use Carbon\Carbon;

class Delta extends Adapter
{
    public function getStats($nWebsiteId, $sStartDate, $sEndDate)
    {
        $nStart = Carbon::createFromFormat('Y-m-d H:i:s', $sStartDate)->timestamp;
        $nEnd   = Carbon::createFromFormat('Y-m-d H:i:s', $sEndDate)->timestamp;

        $sQuery = "SELECT IFNULL(SUM(article_impression), 0) as impressions,
                          IFNULL(SUM(article_click), 0) as clicks,
                          IFNULL(SUM(article_traffic), 0) as traffic
                   FROM website_metrics_daily
                   WHERE website_id = %d
                        AND _date BETWEEN %d AND %d;";


        $sQuery  = sprintf($sQuery, $nWebsiteId, $nStart, $nEnd);
        $aResult = $this->oModel->query_read($sQuery);
        $aStats  = array();

        $aStats['impressions'] = (int) $aResult[0][0]['impressions'];
        $aStats['clicks']      = (int) $aResult[0][0]['clicks'];
        $aStats['traffic']     = (int) $aResult[0][0]['traffic'];

        return $aStats;
    }
}