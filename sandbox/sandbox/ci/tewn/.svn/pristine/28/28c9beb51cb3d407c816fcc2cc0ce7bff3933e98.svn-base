<?php
if (!empty($instance['widget_id'])) :
    $version = '';
    if ( 2 == $instance['version'] ) {
        $version = 'v=2&';
    }
?>
<div class="widget">
    <?php if (!empty($instance['title'])) : ?>
    <h3 class="widget-title"><?php echo esc_attr( $instance['title'] ); ?></h3>
    <?php endif; ?>
    <!-- Crowd Ignite widget -->
    <script type='text/javascript'>
    var _CI = _CI || {};
    (function() {
        var script = document.createElement('script');
        ref = document.getElementsByTagName('script')[0];
        _CI.counter = (_CI.counter) ? _CI.counter + 1 : 1;
        document.write('<div id="_CI_widget_');
        document.write(_CI.counter + '"></div>');
        script.type = 'text/javascript';
        script.src = 'http://widget.crowdignite.com/widgets/<?php echo esc_attr( $instance['widget_id'] ); ?>?<?php echo $version; ?>_ci_wid=_CI_widget_' + _CI.counter;
        script.async = true;
        ref.parentNode.insertBefore(script, ref);
    })();
    </script>
    <?php if( 1 == $instance['show_powered'] ) : ?>
    <div id='widget_powered_div' style='width: 100%; background-color: transparent'><a href='http://crowdignite.com/account/<?php echo esc_attr( $instance['account_id'] ); ?>' style='font: Arial; color:#000000;' target=_blank>Powered by Crowd Ignite</a></div>
<?php endif; ?>
    <!-- END: Crowd Ignite widget -->
</div>
<?php endif; ?>