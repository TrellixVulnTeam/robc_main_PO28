<?php

namespace CI\Content\Provider;
use CI\Content\Provider;

class ContentAd implements Provider
{
    protected $oService = null;
    protected $bTest    = false;

    protected function getServiceObject($aOptions)
    {
        if (empty($this->oService)) {
            $oOptions = new \CI\ArrayManipulator($aOptions);
            $this->oService = new \CI\Http\Service\ContentAd(
                array(
                    'test'      => $oOptions->get('test', $this->bTest),
                    'domain_id' => $oOptions->get('domain_id'),
                )
            );
        }

        return $this->oService;
    }

    public function provide(array $aOptions)
    {
        $oService = $this->getServiceObject($aOptions);
        $aData    = $oService->query()->getData();
        $aItem    = array();

        if (!empty($aData['articles'][0]) && is_array($aData['articles'][0])) {
            $sPixel = empty($aData['debug_pixel'])? '' : $aData['debug_pixel'];
            $aData = new \CI\ArrayManipulator($aData['articles'][0]);
            $aItem = array(
                'title'       => $aData->get('title', ''),
                'description' => $aData->get('title', ''),
                'image'       => $aData->get('image', ''),
                'link'        => $aData->get('url', ''),
                'extra'       => $sPixel,
            );
        }

        return $aItem;
    }
}