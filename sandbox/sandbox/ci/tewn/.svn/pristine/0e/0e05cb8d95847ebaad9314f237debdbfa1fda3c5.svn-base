<?php

namespace CI\Stats\Website\Metrics;

class Daily
{
    protected $oWarehouseDB;

    /**
     * @codeCoverageIgnore
     */
    protected function getDatabaseObject()
    {
        if (empty($this->oWarehouseDB)) {
            $this->oWarehouseDB = new \CI\Database\Warehouse();
        }

        return $this->oWarehouseDB;
    }

    public function getFromDate($nWebsiteId, \Carbon\Carbon $oCarbon)
    {
        $aReturn = $this->getEmptyStats($nWebsiteId);

        if (!empty($nWebsiteId) && $nWebsiteId > 0 && $oCarbon->timestamp > 0 ) {
            $oDatabase = $this->getDatabaseObject();
            $sQuery    = 'SELECT
                website_id, account_incoming, account_outgoing, account_credits
                FROM website_metrics_daily WHERE website_id = (%s) AND _date = %s;';
            $aReturn = array_merge($aReturn, $oDatabase->query(
                printf(
                    $sQuery,
                    $nWebsiteId,
                    $nTimestamp
                ))
            );
        }

        return $aReturn;
    }

    protected function getEmptyStats($nWebsiteId)
    {
        return array(
            'website_id' => $nWebsiteId,
            'incoming'   => 0,
            'outgoing'   => 0,
            'credits'    => 0
        );
    }
}