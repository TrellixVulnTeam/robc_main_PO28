<?php
namespace Test\Error\Dealer;

use CI\Error\Dealer\Mail;

/**
 * @group error
 * @group error_dealer
 * @group error_dealer_mail
 */
class MailTest extends \PHPUnit_Framework_TestCase
{
    public function test_on_success_mail_should_be_delivered()
    {
        $errorFixture = array();

        $mail = new MailSpy($this->getMock("\CI\Error\Formatter\PlainText"));
        $mail->deal($errorFixture);

        $this->assertTrue($mail->isMailSent());
    }
}

class MailSpy extends Mail
{
    protected $methodWasInvoked = false;

    public function isMailSent()
    {
        return $this->methodWasInvoked;
    }

    /**
     * Override the parent send mail just to be sure that the method was called.
     */
    protected function sendMail()
    {
        $this->methodWasInvoked = true;
    }
}