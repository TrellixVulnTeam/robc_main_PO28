<?php

namespace CI\Formulas;

class LandingPage
{
    protected $oSetting;
    /**
     * @codeCoverageIgnore
     */
    protected function getSettingObject()
    {
        if (empty($this->oSetting)) {
            $this->oSetting = new \CI\Config\System\Setting();
        }

        return $this->oSetting;
    }

    public function getWeightModifier($aAccount, $nRank, $nAccountCount, $bPaid = false)
    {
        $nReturn = 0;

        $oSetting = $this->getSettingObject();

        if ($nAccountCount !== 0) {
            $nLandingAccountFallOffRate = $oSetting->get('LANDING_PAGE_ACCOUNT_FALLOFF_RATE');
            $nNumber                    = pow(($nAccountCount - $nRank), $nLandingAccountFallOffRate);
            $nDenom                     = pow($nAccountCount, $nLandingAccountFallOffRate);
            $nReturn                    = 1 - ($nNumber/$nDenom);
        } else {
            $nReturn = 1;
        }

        // Click-Through to Service
        // Level Agreement Ratio is a
        // tunable for how much we
        // care about meeting SLA
        // requirements vs getting
        // visitors into Crowd Ignite
        $nReturn = (1 - ($nReturn * $oSetting->get('LANDING_PAGE_SLA_TO_CTR_RATIO')));

        if ($nRank == 0) {
            // The top account gets a
            // bonus and gets an "increment"
            $nReturn += $oSetting->get('LANDING_PAGE_ACCOUNT_TOP_BONUS');
        }

        // Featured accounts get a bonus
        if ($aAccount['featured'] && $oSetting->get('LANDING_PAGE_GIVE_FEATURED_BONUS')) {
            $nReturn += $aAccount['featured'];
        }

        return $nReturn;
    }
}