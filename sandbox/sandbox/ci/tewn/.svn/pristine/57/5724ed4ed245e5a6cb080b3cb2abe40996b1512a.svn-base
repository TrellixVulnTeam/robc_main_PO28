<?php
class HistoryPagesControllerTest extends CakeTestCase{
	var $HistoryPages = null;
	var $fixtures = array('app.history_page', 'app.website', 'app.page', 'app.settings', 'app.stats_page');

	function startTest() {
		App::import('Controller', 'HistoryPages');
		$this->HistoryPages = new HistoryPagesController();
		$this->HistoryPages->constructClasses();
		$this->HistoryPages->autoRender = false;
        $this->HistoryPages->cache_on = false;
	}

	function testHistoryPagesControllerInstance() {
		$this->assertTrue(is_a($this->HistoryPages, 'HistoryPagesController'));
	}

	function testHistoryPagesStatRange(){
		$page_id = 16185348;
		$datetime_start = '2013-10-05 06:00:00';	//date('Y-m-d G:i:s', strtotime('yesterday noon'));
		$datetime_end = '2013-10-05 10:00:00';	//date('Y-m-d G:i:s', strtotime('tomorrow noon'));
		$results = $this->HistoryPages->stats_range($page_id, $datetime_start, $datetime_end);
		$this->assertTrue($results);

		$expected = array('impressions'=>150);
		$this->assertEqual($results, $expected);
	}

	function endTest() {
		unset($this->HistoryPages);
	}
}
