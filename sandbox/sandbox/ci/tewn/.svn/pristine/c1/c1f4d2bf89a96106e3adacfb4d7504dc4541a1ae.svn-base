 WebFontConfig = {
	custom: { families: ['LeagueGothicRegular'],
		  urls: [ '/css/craveonline/ranker_lp.css' ]
		}
    };
    (function loadFonts() {
	var wf = document.createElement('script');
	wf.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
	wf.type = 'text/javascript';
	wf.async = 'true';
	var s = document.getElementsByTagName('script')[0];
	s.parentNode.insertBefore(wf, s);
    })();

$(document).ready(function() {
    $('#links_content').masonry({
	itemSelector: '.item',
	columnWidth: 1,
	isFitWidth: true,
	isAnimated: true,
	animationOptions: {
	    duration: 300,
	    easing: 'linear',
	    queue: false
	}
    });

    //$('#links_content div:first-child .item:first-child').addClass('large_item');

    $boxes = $('#links_content > div').children('.grid_5');
    for(i=0;i<=10;i++) {
            var pos = 1 + Math.floor(Math.random() * ($boxes.length-1) )
            $boxes.eq(pos).before("<div class='item empty'></div>");
    }

    // truncate long titles
    $('.item').each( function() {
	var title = $(this).find('div.text p a');
	if( title.text().length >= 40 ) {
	    var short_title = jQuery.trim( title.text() ).substring(0, 40).split(" ").slice(0, -1).join(" ") + "..."
	    title.text( short_title );
	}
    });

    $('#links_content').masonry( 'reload' );

    $('#links_content .item').click(function() {
        if( !$(this).hasClass('large_item') && !$(this).hasClass('empty') ) {

            var page_id = $('.large_item').data("page");
            var rank_level = $('.large_item').data("ranklevel");

            if( !rank_level ) rank_level=Math.floor(Math.random()*101);

            var rank_text = '';

            switch (true) {
                case (rank_level < 20 ): rank_text = 'Still Rising'; break;
                case (rank_level >= 20 && rank_level < 40): rank_text = 'Regular'; break;
                case (rank_level >= 40 && rank_level < 60): rank_text = 'Very Popular'; break;
                case (rank_level >= 60 && rank_level < 80): rank_text = 'Highly Popular'; break;
                case (rank_level >= 80 ): rank_text = 'Super Hot'; break;
            }

            $('#ranker_meter').remove();
            $('.meter').remove();
            $('#ranker_site_info').remove();
            $('#links_content .item').removeClass('large_item');

            $(this).addClass('large_item');

            $('.large_item').prepend('<div id="ranker_site_info"><h3>DAILY CRAVINGS</h3><ul><li>You may also like</li><li><a href="#">Exclusive Captain America Photos</a></li><li><a href="#">Meet Bobby Kotick</a></li><li><a href="#">E3: NBA 2K12 Preview</a></li><li><a href="#">Another Star Says Good Bye From TNA</a></li></ul><div class="meter"></div></div>');
            $('.large_item .meter').prepend('<p>Link Popularity <span>'+rank_text+'</span></p><div id="ranker_meter"></div>');
            $('#links_content').masonry( 'reload' );
            $('#ranker_site_info').fadeIn(1000);

            if(rank_level != "") {
                 $('.large_item #ranker_meter').rankermeter( {percentage: rank_level});
            }
            return(false);
        }

    });

    $(".item a").hover(function() {
        if( !$(this).parent().parent().hasClass('large_item') ) {
            $(this).parent().find("img").stop().animate({ opacity: 0.4}, 150).animate({ opacity: 1 }, 100);
        }
    },function() {

    });


});

( function( $ ){
	$.fn.rankermeter = function( options ){
		var $this = $( this );
		if ( $this.length > 1 ) {
			$this.each( function(){
				$( this ).rankermeter( options );
			});
			return $this;
		}
		var def = {
			percentage : $.trim( $this.html() ) || 0,
			scale: 100,
			minimum: 0,
			maximum: 100,
			animate:true,
			thisCss: {
				position: 'relative',
				width: '98px',
				height: '70px',
				padding: '0px',
				border: '0px',
				fontFamily: 'Arial',
				fontWeight: '900',
				backgroundImage : "url('/img/ranker_lp/ranker_meter.jpg')"
			}
		}		
		$this.html( '' );		
		$this.css( def.thisCss );		
		$.extend( def, options );
		
		if ( !(def.percentage > def.maximum || def.percentage < def.minimum )) {
			$this.jqcanvas ( function ( canvas, width, height ) {
				var ctx = canvas.getContext ( "2d" ),
				lingrad, thisWidth;
				ctx.lineWidth = 3;
				ctx.strokeStyle = "rgb(30,30,30)";
				ctx.translate( 49,50 );								
				ctx.save();
				function animate(){		
					ctx.restore();
					ctx.save();
					ctx.clearRect( -40, -40, 100,100 );
					ctx.rotate( ((i*.9)+5) * Math.PI / def.scale );		
					ctx.beginPath();
					ctx.moveTo( -40,0 );
					ctx.lineTo( 0,0 );
					ctx.stroke();					
					$this.data('currentPercentage',i);
					if ( i != def.percentage ) {
						i += Math.abs( def.percentage - i ) < 1 ? def.percentage - i : def.increment;
						setTimeout(function(){ animate() }, 20);
					}
				}
				if (def.animate) {
					var i = parseInt( $this.data('currentPercentage') ) || 0;
					def.increment = ( i < def.percentage ) ? 1 : -1;
				} else {
					var i = ( def.percentage );
				}
				animate();
			}, { verifySize: false, customClassName: '' } );
		}
		return $this;
	}
})( jQuery )