<?
	function tab_selected($status_a, $status_b) {
		// Hack for casting issue
		if ($status_a === "all" &&
			$status_b === 0) {
			return "tab_unselected";
		}

		if ($status_a == $status_b) {
			$selected_class = "tab_selected";
		} else {
			$selected_class = "tab_unselected";
		}
		return $selected_class;
	}

?>

<link rel="stylesheet" type="text/css" href="/css/tablesort.css">
</script><script type="text/javascript" src="/js/jquery.tablesorter.js"></script>
<script>

jQuery(document).ready(function() {

	jQuery.tablesorter.addParser({
		id: "commaDigit",
		is: function(s, table) {
		var c = table.config;
		return jQuery.tablesorter.isDigit(s.replace(/,/g, ""), c);
		},
		format: function(s) {
			return jQuery.tablesorter.formatFloat(s.replace(/,/g, ""));
		},
		type: "numeric"
	});

		$("#pages_table").tablesorter();

});
</script>


<div class="row main">
<div id="content" class="column grid_12">

<?
	echo $this->element("management_toolbar", array("tab" => ""));

	$base_intersect = $intersect->get_intersect_by_id($intersect_id);
	$category = $base_intersect['category'];
	$content_rating = $base_intersect['content_rating'];
?>

		<!-- Domains -->
		<table cellpadding=0 border=0>
		<tr>
		<td>
			<? $selected_class = tab_selected($hub, "all"); ?>
			<div class="tab <?=$selected_class?>" id="">
				<a class="<?=$selected_class?>" href="/management/landing_page_analytics/<?=$intersect_id?>/0">All</a>
			</div>
				</td>
		<?
		$all_domain_bits = $domain_component->getAllBits();
		foreach ($all_domain_bits as $domain_bit) {
			$domain_name = $convert->domain_name_bit($domain_bit);
			$domain_id = $domain_component->bitToId($domain_bit);
		?>
		<td>
			<? $selected_class = tab_selected($hub, $domain_id); ?>
			<div class="tab_small <?=$selected_class?>" id="">
				 <a class="<?=$selected_class?>" href="/management/landing_page_analytics/<?=$intersect_id?>/<?=$domain_id?>"><?=$domain_name?></a>
			</div>
				</td>
		<?
		}
		?>
		</tr>
		</table>

		<!-- Category -->
		<table cellpadding=0 border=0>
		<tr>
		<?
			foreach ($categories as $cat_id) {
				$cat = $convert->category_short($cat_id);
				$selected_class = tab_selected($category, $cat_id);

				$tmp_intersect = $base_intersect;
				$tmp_intersect['category'] = $cat_id;
				$tmp_intersect_id = $intersect->get_id_by_intersect($tmp_intersect);
		?>
				<td>
					 <div class="<?=$selected_class?> tab_small" id="">
						 <a class="<?=$selected_class?>" href="/management/landing_page_analytics/<?=$tmp_intersect_id?>/<?=$hub?>"><?=$cat?></a>
					</div>
						</td>
		<?
			}
		?>
		</tr>
		</table>

		<!-- Content Rating -->
		<table cellpadding=0 border=0>
		<tr>
		<?
			$content_ratings = $convert->content_rating_select();
			foreach ($content_ratings as $tmp_content_id => $content) {
				$selected_class = tab_selected($content_rating, $tmp_content_id);

				$tmp_intersect = $base_intersect;
				$tmp_intersect['content_rating'] = $tmp_content_id;
				$tmp_intersect_id = $intersect->get_id_by_intersect($tmp_intersect);
		?>
				<td>
					 <div class="<?=$selected_class?> tab" id="">
						 <a class="<?=$selected_class?>" href="/management/landing_page_analytics/<?=$tmp_intersect_id?>/<?=$hub?>"><?=$content?></a>
					</div>
						</td>
		<?
			}
		?>
		</tr>
		</table>

<div class="row">

  <div class="column grid_12">

	<h3 class="topContent">Landing Page Active Pages</h3>


	 <div class="row" id="content_area">

		<div class="column grid_12">

		<div style="margin-left:10px;margin-top:18px;">


	 <table id="pages_table" class="tablesorter">
		<thead>
	 <tr>
	<th>ID</th>
	<th>Page</th>
	<th>Page Website</th>
	<th>Type</th>
	<th>Page Match</th>
	<th>Num Clicks</th>
	<th>Num Display</th>
	<th>Lifetime CTR</th>
	<th>Rolling CTR</th>
	<th>Weight</th>
	<th>Weight VW</th>
	<th>Created</th>
	<th>Image</th>
	</tr>
		</thead>
		<tbody>
<?
	foreach ($analytics as $page) {

		$image_html = $image->zoom_crop($page['Page']['image'], 140, 80, true, array(), true, false, $page['Page']['image_server'], false, true);
?>
		<tr>

		<!-- ID -->
		<td><?=$page['LandingPageAnalytic']['id']?></td>

		<!-- Page -->
		<td><a href="/pages/moderate/<?=$page['Page']['website_id']?>/<?=$page['Page']['id']?>"><?=$page['Page']['title']?></td>

		<!-- Page Website -->
		<td><a href="/websites/moderate/<?=$page['Page']['website_id']?>"><?=$page['Website']['name']?></a></td>

		<!-- Type -->
		<td><?=$convert->link_type($page['LandingPageAnalytic']['type'])?></td>

		<!-- Key -->
		<td><?=$convert->link_key_html($page['LandingPageAnalytic']['type'], $page['Key'])?>
		</td>

		<!-- Num Clicks -->
		<td><?=$page['LandingPageAnalytic']['num_ctr']?></td>

		<!-- Num Display -->
		<td><?=$page['LandingPageAnalytic']['num_display']?></td>

		<!-- Lifetime CTR -->
		<td><?=round($page['LandingPageAnalytic']['num_ctr']/($page['LandingPageAnalytic']['num_display'] ? $page['LandingPageAnalytic']['num_display'] : 1), 5) * 100?>%</td>

		<!-- Rolling CTR -->
		<td><?=round($page['LandingPageAnalytic']['ctr'] * 100, 3)?>%</td>

		<!-- Weight -->
		<td><?=$page['LandingPageAnalytic']['weight_ctr']?></td>

		<!-- Weight VW-->
		<td><?=$page['LandingPageAnalytic']['weight_ctp']?></td>

		<!-- Created -->
		<td><?=$page['LandingPageAnalytic']['created']?></td>

		<!-- Image -->
		<td>
	<a href="<?=$page['Page']['url']?>"><img src="<?=$image_html?>"></a>
	</td>

		</tr>

<?
		}
?>
		</tbody>
	</table>

	 </div>


	<h3 class="bottomContent"></h3>

</div> <!--  end of content column -->

</div> <!--  end of content row -->



