<?php

class EngineHelper extends AppHelper {
	private $fields = 10;

	public function header_row($title) {
		// TODO remove ugly inline style and have it into the css file
		$output = array(
			'<tr>',
			'<td style="text-align: center; background-color: #EA956E" colspan="'.$this->fields.'">',
			'<strong>---- '.$title.' ----</strong>',
			'</td>',
	 		'</tr>'
		);
		return implode(PHP_EOL, $output);
	}

	public function data_row($title, $run, $engine_data, $script_status) {
		$output = array();
		$warning_style = 'style="background-color: #f2bfbf;"';

		$output[] = '<tr class="data_row">';
		$output[] = '<td>'.$title.' <span class="info_icon tooltip" title="php cron_dispatcher.php '.$run.'">'.$run.'</span></td>';

		$td_attention = $engine_data['HistoryTimer']['time_warning'] ? $warning_style : '';
		$output[] = '<td style="text-align: center">'.(isset($engine_data['HistoryTimer']['progress']) ? number_format($engine_data['HistoryTimer']['progress'], 2) . '%' : '?').'</td>';
		$output[] = '<td style="text-align: center">'.(isset($engine_data['HistoryTimer']['running']) ? ($engine_data['HistoryTimer']['running'] ? 'Yes' : 'No') : '?').'</td>';
		$output[] = '<td '.$td_attention.'>'.$engine_data['HistoryTimer']['minutes'].' mins. '.$engine_data['HistoryTimer']['seconds'].' secs.</td>';
		$output[] = '<td>'.$engine_data['HistoryTimer']['max_minutes'].' mins. '.$engine_data['HistoryTimer']['max_seconds'].' secs.</td>';

		$td_attention = $engine_data['HistoryTimer']['memory_warning'] ? $warning_style : '';
		$output[] = '<td '.$td_attention.'>'.$engine_data['HistoryTimer']['memory'].'MB</td>';
		$output[] = '<td>'.$engine_data['HistoryTimer']['max_memory'].'MB</td>';

		$warning_style = 'style="background-color: #f2bfbf; text-align: center"';
		$td_attention = $engine_data['HistoryTimer']['last_ran_warning'] ? $warning_style : 'style="text-align: center"';
		$date = $engine_data['HistoryTimer']['created'] ? date('n/d/y H:i:s', strtotime($engine_data['HistoryTimer']['created'])) : '--/--/-- --:--:--';
		$output[] = '<td '.$td_attention.'>'.$date.'</td>';
		// $output[] = '<td><span class="info_icon ' . preg_replace('/\s+/', '', strtolower($script_status)) . '">'.$script_status.'</span>'. $script_status . '</td>';
		$output[] = '</tr>';

		return implode(PHP_EOL, $output);
	}
}