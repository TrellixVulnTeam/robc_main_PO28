$(document).ready(function() {
    var tpl_row_collector = Handlebars.compile($('#tpl-row-collector').html());

    function switchChange(event, state) {
        var $checkbox = $(this);
        $.post('/developers/action/switch_collector', {id: $checkbox.data('id'), state: state}, function (response) {
            $('#collectors_param').val(response.data.collectors_param);
            updateActivationList();
        }, 'json');
    }

    function updateActivationList() {
        $('#activate-list .do-activate').each(function () {
            var $link = $(this);
            $link.attr('href', $link.data('href') + $('#collectors_param').val());
        });
    }

    $('.do-add-collector').on('click', function (event) {
        var name = $('#name-collector').val();
        $.post('/developers/action/add_collector', {name: name}, function (response) {
            $('#name-collector').val('');
            $('#collectors-list').append(tpl_row_collector(response.data.collector));
            $('#collectors-list input.switch').last().bootstrapSwitch();
            $('#collectors-list input.switch').last().on('switchChange.bootstrapSwitch', switchChange)
            $('#modal-add-collector').modal('hide');
        }, 'json');
    });

    $('input.switch').bootstrapSwitch();

    $('input.switch').on('switchChange.bootstrapSwitch', switchChange);

    updateActivationList();
});