<?

class HistorySocial extends AppModel
{
	var $name = 'HistorySocial';
	var $useDbConfig = 'warehouse';

	function stats_set($point) {
		$stats['likes_fb'] = 0;
		$stats['shares_fb'] = 0;
		$stats['comments_fb'] = 0;
		//$stats['clicks_fb'] = 0;

		if ($point && isset($point['HistorySocial']['likes_fb'])) {
			$stats['likes_fb'] = $point['HistorySocial']['likes_fb'];
			$stats['shares_fb'] = $point['HistorySocial']['shares_fb'];
			$stats['comments_fb'] = $point['HistorySocial']['comments_fb'];
		}

		return $stats;
	}

	function point($datetime_start, $datetime_end, $page_id = 0) {
		$conditions = array(
			"created >=" => $datetime_start,
			"created <=" => $datetime_end,
							);
		if ($page_id) {
			$conditions['page_id'] = $page_id;
		}

		$point = $this->find("first", array("conditions" => $conditions,
										  "order" => "created DESC"));		

		$stats = $this->stats_set($point);

		return $stats;
	}

	function base_point($base_start, $datetime_start, $page_id = 0) {
		$point = $this->point($base_start, $datetime_start, $page_id);
		
		if (!$point) {
			$conditions = array(
				"created <=" => $base_start
								);
			if ($page_id) {
				$conditions['page_id'] = $page_id;
			}

			$point = $this->find("first", array("conditions" => $conditions,
												"order" => "created DESC"));		

			$point = $this->stats_set($point);
		}
		
		return $point;
	}

}

?>