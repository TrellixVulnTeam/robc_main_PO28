<?
	function tab_selected($status_a, $status_b) {
		// Hack for casting issue
		if ($status_a === "all" &&
		    $status_b === 0) {
			return "tab_unselected";
		}

		if ($status_a == $status_b) {
			$selected_class = "tab_selected";
		} else {
			$selected_class = "tab_unselected";
		}
		return $selected_class;
	}

?>
<link rel="stylesheet" type="text/css" href="/css/tablesort.css">
</script><script type="text/javascript" src="/js/jquery.tablesorter.js"></script>
<script type="text/javascript">

jQuery(document).ready(function() { 						 
	jQuery.tablesorter.addParser({
		id: "commaDigit",
		is: function(s, table) {
		var c = table.config;
		return jQuery.tablesorter.isDigit(s.replace(/,/g, ""), c);
		},
		format: function(s) {
			return jQuery.tablesorter.formatFloat(s.replace(/,/g, ""));
		},
		type: "numeric"
	});

    $("#users_table").tablesorter();

});

function check_length() {
	     var str = jQuery("#username").val();
	     if (str.length > 3) {
		     return true;
	     } else {
		     return false;
	     }
     }
</script>

<div class="row main">
	<div id="content" class="column grid_12">
		<?
			echo $this->element("management_toolbar", array("tab" => "user", "user" => $user));
		?>
		<table cellpadding=0 border=0>
			<tr>
				<td>
					<? $selected_class = tab_selected($queue_view, 0); ?>
					<div class="tab <?=$selected_class?>" id="">
						<a class="<?=$selected_class?>" href="/management/rebalance_queue/0">Widgets</a>
					</div>
				</td>
				<td>
					<? $selected_class = tab_selected($queue_view, 1); ?>
					<div class="tab <?=$selected_class?>" id="">
						<a class="<?=$selected_class?>" href="/management/rebalance_queue/1">Landing Pages</a>
					</div>
				</td>
			</tr>
		</table>

		<div class="row">
			<div class="column grid_12">
				<h3 class="topContent">Rebalance Queues</h3>
			</div>
			<div class="row" id="content_area">				
	    		<div class="column grid_12">
	    			<? 
	    				$session->activate(); 
						if ($session->check('Message.flash')) {
							$session->flash();
						}
	    			?>
					<div style="margin-left:30px;margin-top:18px;">			
						<center>
							<? if ($queue_view == 0) { ?>
							<table id="users_table" class="tablesorter" cellpadding="1" width=100% cellspacing="0" border=1 style="padding: 2px 4px 2px 4px; border: 1px solid #660000;">
								<thead>
									<tr>
										<th>ID</th>
										<th>Website Name</th>
										<th>Impressions</th>
										<th>Last Rebalance</th>
										<th>Rebalance</th>
									</tr>						
								</thead>
								<tbody>
									<? 
									$w_total_display = 0;
									foreach($w_rebalances as $rebalance) {
										$w_display = $rebalance["WidgetRebalance"]["num_display"];
										$website_id = $rebalance["Website"]["id"];
										$w_total_display += $w_display;
										echo "<tr>";
										echo "<td><a href='/websites/moderate/".$website_id."'>".$website_id."</a></td>";
										echo "<td><a href='http://".$rebalance['Website']['url']."'>".$rebalance["Website"]["name"]."</a></td>";		
										echo "<td>".number_format($w_display)."</td>";
										echo "<td>".$rebalance['Account']['widget_rebalance']."</td>";
										echo "<td><a href='http://".ENGINE_URL."/widget_engine/rebalance/".$rebalance['Website']['id']."''>Rebalance</td>";
										echo "</tr>";
										} 										

									?>

								</tbody>
								<tfoot>
									<tr>
										<td></td>
										<td></td>
										<td><?=$convert->round_nice($w_total_display)?></td>
										<!--<td></td>-->
										<td></td>
									</tr>
								</tfoot>
							</table>
							<? } else if ($queue_view == 1) { ?>
							<table id="users_table" class="tablesorter" cellpadding="1" width=100% cellspacing="0" border=1 style="padding: 2px 4px 2px 4px; border: 1px solid #660000;">
								<thead>
									<tr>
										<th>Domain</th>
										<th>Category</th>
										<!--
										<th>Gender</th>
										<th>Age</th>
										-->
										<th>Content Rating</th>
										<th>Num Impressions</th>
										<!--
										<th>Last Rebalance</th>
										<th>Rebalance</th>
										-->
									</tr>						
								</thead>
								<tbody>
									<? 
									$lp_total_display = 0;
									foreach($lp_rebalances as $rebalance) {
										$lpr = $rebalance["LandingPageRebalance"];
										$lp_display = $lpr["num_display"];
										$lp_total_display += $lp_display;
										echo "<tr>";
										echo "<td>".$convert->domain_name_bit($lpr['domain_bitfield'])."</td>";
										echo "<td>".$convert->category($lpr['category'])."</td>";
										//echo "<td>".$convert->demographic_sex($lpr['demographic_sex'])."</td>";
										echo "<td>".$convert->content_rating($lpr['content_rating'])."</td>";
										echo "<td>".number_format($lp_display)."</td>";
										//echo "<td></td>";
										//echo "<td></td>";
										//echo "<td><a href='/widget_engine/rebalance/".$rebalance['Website']['id']."''>Rebalance</td>";
										echo "</tr>";
										} 										
									?>
								</tbody>
								<tfoot>
									<tr>
										<td></td>
										<td></td>
										<!--
										<td></td>
										<td></td>
										-->
										<td><?=$convert->round_nice($lp_total_display)?></td>
										<!--
<td></td>
										<td></td>-->
									</tr>
								</tfoot>
							</table>

							<? } ?>
				
						</center>
					</div>
				</div>
				
			</div>
		</div>