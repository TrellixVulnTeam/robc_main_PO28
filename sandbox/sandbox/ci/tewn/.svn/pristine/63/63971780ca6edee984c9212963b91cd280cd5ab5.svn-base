<?php
    $google_analytic_id = null;
    $google_tag_slot    = null;

    switch (DOMAIN_ID) {
        case DOMAIN_ID_CROWD_IGNITE:
            $google_tag_slot = array(
                'domain' => 'gn.crowdignite.com',
                'div_id' => 'div-gpt-ad-1368572708973'
            );

            break;
        case DOMAIN_ID_GAME_REVOLUTION:
            $google_analytic_id = 'UA-2328145-1';

            $google_tag_slot = array(
                'domain' => 'gn.grcrowdignite.com',
                'div_id' => 'div-gpt-ad-1368573000095'
            );

            break;
        case DOMAIN_ID_CRAVE_ONLINE:
            $google_analytic_id = 'UA-94323-62';

            $google_tag_slot = array(
                'domain' => 'gn.cr-crowdignite.com',
                'div_id'    => 'div-gpt-ad-1368570367809'
            );

            break;
        case DOMAIN_ID_MOMTASTIC:
            $google_analytic_id = 'UA-15895888-1';

            $google_tag_slot = array(
                'domain' => 'gn.mom-crowdignite.com',
                'div_id'    => 'div-gpt-ad-1368573192812'
            );

            break;
        case DOMAIN_ID_THEFASHIONSPOT:
            $google_tag_slot = array(
                'domain' => 'gn.tfscrowdignite.com',
                'div_id'    => 'div-gpt-ad-1368573425610'
            );

            break;
        case DOMAIN_ID_TOTALLYHER:
            $google_tag_slot = array(
                'domain' => 'gn.thcrowdignite.com',
                'div_id'    => 'div-gpt-ad-1368573531004'
            );

            break;
        case DOMAIN_ID_NEWS:
            $google_tag_slot = array(
                'domain' => 'gn.crowdignite.com',
                'div_id'    => 'div-gpt-ad-1368572708973'
            );

            break;
        case DOMAIN_ID_ES:
            $google_tag_slot = array(
                'domain' => 'gn.crowdignite.com',
                'div_id'    => 'div-gpt-ad-1368572708973'
            );

            break;
    }

?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <style type="text/css">
            @font-face {
                font-family: 'Roboto';
                font-style: normal;
                font-weight: 400;
                src: local('Roboto Regular'), local('Roboto-Regular'), url(http://<?php echo CDN_URL; ?>/css/font/400.woff) format('woff');
            }
            @font-face {
                font-family: 'Roboto';
                font-style: normal;
                font-weight: 700;
                src: local('Roboto Bold'), local('Roboto-Bold'), url(http://<?php echo CDN_URL; ?>/css/font/700.woff) format('woff');
            }
        </style>
        <title><?php echo $title_for_layout; ?></title>
        <meta name="description" content="<?php echo SITE_DESCRIPTION; ?>" >
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
        <meta name="viewport" content="initial-scale=1">

        <link href="http://<?=CDN_URL?>/img/<?=DOMAIN?>/favicon.ico" rel="shortcut icon" type="image/x-icon" />
        <link rel="apple-touch-icon" href="http://<?=CDN_URL?>/img/<?=DOMAIN?>/favicon.ico" type="image/png" />

        <?php $html->css('reset', 'stylesheet', null, false); ?>
        <?php $html->css('masonary/default', 'stylesheet', null, false); ?>
        <?php $html->css('masonary/'.DOMAIN, 'stylesheet', null, false); ?>
        <?php $html->css('custom_landing_page', 'stylesheet', null, false); ?>
        <?php $javascript->link('jquery-2.1.0.min', false); ?>
        <?php $javascript->link('landing/masonary.min', false); ?>
        <?php $javascript->link('landing/layout', false); ?>

        <?php
            if (isset($canonical)) {
                echo '<link rel="canonical" href="' . $canonical . '"/>';
            }
            echo $this->element('masonary/analytic', array('google_analytic_id' => $google_analytic_id));
            echo $this->element("analytic_outbound_tracker");
            echo $this->element("chartbeat_start");
        ?>
        <?php echo $asset->scripts_for_layout(array('css')); ?>
    </head>
    <body>
        <?php echo $this->element('masonary/header', array("google_tag_slot" => $google_tag_slot));?>
        <div id="body" data-layout='<?php echo $landing_settings; ?>'>
            <?php
                $image_assets = new \CI\Asset\Image();

                foreach($pages as $page) {
                    if (isset($page['ads']) && !isset($zemanta)) {
            ?>
                        <div class="card ads_container">
                            <div class="ads" id="<?php echo $google_tag_slot['div_id']; ?>-0"></div>
                            <div class="word">Advertisement</div>
                        </div>
            <?php
                        continue;
                    } elseif (isset($page['ads']) && isset($zemanta)) {
                        $card = array(
                            'image_src'       => $zemanta->get('thumbnail_url', ''),
                            'is_clicked_page' => false,
                            'page'            => array(
                                'Page' => array(
                                    'title'       => $zemanta->get('title', ''),
                                    'ctr_link'    => $zemanta->get('url', ''),
                                    'description' => $zemanta->get('excerpt', ''),
                                ),
                            ),
                         );
                        echo $this->element('masonary/card', $card);
                        continue;
                    }

                    $image_width  = 300;
                    $image_height = 250;

                $is_clicked_page = isset($clicked_page['Page']['id']) && ($clicked_page['Page']['id'] == $page['Page']['id']);

                if ($is_clicked_page) {
                    $image_width = 410;
                    $image_height = 333;
                }

                $image_src = $image_assets->getUrl(
                    array(
                        'page_id' => $page['Page']['id'],
                        'type' => \CI\Asset\Image::URL_CROP_FULL,
                        'image' => $page['Page']['image'],
                        'width' => $image_width,
                        'height' => $image_height,
                        'extra_dirs' => array(
                            DOMAIN_ID,
                            $page['Page']['intersect_id']
                        ),
                        'extra_parameters' => array(
                            't' => strtotime($page['Page']['moderator_modified']),
                        )
                    )
                );

            ?>
                    <?php
                        $card = array(
                                      'image_src'       => $image_src,
                                      'page'            => $page,
                                      'is_clicked_page' => $is_clicked_page
                                     );
                        echo $this->element('masonary/card', $card);
                    ?>
            <?php
                }
            ?>

            <?php echo $this->element('debugbar'); ?>
        </div>

        <?php echo $asset->scripts_for_layout(array('js')); ?>

        <?php
            if (false == $isHomepage) {
        ?>
            <script type="text/javascript">
                var googletag = googletag || {};
                googletag.cmd = googletag.cmd || [];

                (function() {
                    var gads = document.createElement('script');
                    gads.async = true;
                    gads.type = 'text/javascript';
                    var useSSL = 'https:' == document.location.protocol;
                    gads.src = (useSSL ? 'https:' : 'http:') +
                        '//www.googletagservices.com/tag/js/gpt.js';
                    var node = document.getElementsByTagName('script')[0];
                    node.parentNode.insertBefore(gads, node);
                })();

                $(window).load(function(){
                    googletag.cmd.push(function() {
                        googletag.defineSlot("/4403/<?php echo $google_tag_slot['domain']; ?>/home", [300, 250], "<?php echo $google_tag_slot['div_id'];?>-0").addService(googletag.pubads());
                        googletag.defineSlot("/4403/<?php echo $google_tag_slot['domain']; ?>/home", [728, 90],  "<?php echo $google_tag_slot['div_id'];?>-1").addService(googletag.pubads());
                        googletag.pubads().enableAsyncRendering();
                        googletag.enableServices();
                        googletag.display("<?php echo $google_tag_slot['div_id'];?>-0");
                        googletag.display("<?php echo $google_tag_slot['div_id'];?>-1");
                    });
                });
            </script>
        <?php
            }
        ?>

        <?php
            echo $this->element(DOMAIN . '/footer');
        ?>
