<?php

namespace CI\Stats;

class Article extends \CI\Stats
{
    public function getEmptyStats()
    {
        return array(
            'clicks'      => 0,
            'impressions' => 0,
            'traffic'     => 0
        );
    }

    public function validateConditions()
    {
        $oValidator = new \CI\Validator\Options();
        $oValidator->setOptions(
            array(
                'website_id' => 'required|numeric',
                'start_date' => 'required|string',
                'end_date'   => 'required|string'
            )
        );

        $bValid = $oValidator->isValid($this->aConditions);
        $this->setErrors(array_values($oValidator->getMessages()));

        return $bValid;
    }

    public function process()
    {
        $sStart     = $this->aConditions['start_date'];
        $sEnd       = $this->aConditions['end_date'];
        $nWebsiteId = $this->aConditions['website_id'];

        $oArticle = new \CI\Stats\Article\Delta($this->aConditions['model']);

        return $oArticle->getStats($nWebsiteId, $sStart, $sEnd);
    }

    public function setDateRange($sStart, $sEnd)
    {
        $this->addCondition(
            array(
                'start_date' => $sStart,
                'end_date'   => $sEnd
            )
        );

        return $this;
    }

    public function setModel($oModel)
    {
        $this->addCondition(array('model' => $oModel));

        return $this;
    }

    public function setWebsiteId($nId)
    {
        $this->addCondition(array('website_id' => $nId));

        return $this;
    }

}